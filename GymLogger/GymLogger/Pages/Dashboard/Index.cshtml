@page
@model GymLogger.Pages.Dashboard.IndexModel
@using Microsoft.AspNetCore.Identity
@inject UserManager<User> UserManager
@{
	<h1>Vítej, @UserManager.GetUserName(User)!</h1>

	<p>Zobrazit přehled tréninků</p>
	<a asp-page="/Sessions/Index">Moje tréninky</a>

    <h2>Přidat nový trénink</h2>

    <form method="post" id="sessionForm">
        <div class="form-group">
            <label>Vyber trénink</label>
            <select asp-for="SelectedSessionId" class="form-control" id="sessionSelect">
                @if (Model.LastSession != null)
                {
                    <option value="@Model.LastSession.Id">Přidat k poslednímu tréninku: @Model.LastSession.Name</option>
                }
                <option value="">Zvolit vlastní název</option>
            </select>
        </div>

        <input type="hidden" asp-for="NewSession.Name" id="newSessionName" />

        <h3>Cvik</h3>
        <div class="form-group">
            <label>Cvik</label>
            <select asp-for="NewExerciseSession.ExerciseId" asp-items="Model.Exercises" class="form-control"></select>
            <small>nebo přidej nový cvik:</small>
            <input asp-for="NewExerciseName" class="form-control mt-1" placeholder="Nový cvik..." />
        </div>
        <div class="form-group">
            <label for="NewExerciseSession_Weight">Váha (kg)</label>
            <input asp-for="NewExerciseSession.Weight" class="form-control" type="number" step="0.5" />
        </div>
        <div class="form-group">
            <label for="NewExerciseSession_NofRepetitions">Počet opakování</label>
            <input asp-for="NewExerciseSession.NofRepetitions" class="form-control" type="number" />
        </div>
        <div class="form-group">
            <label for="NewExerciseSession_NofSets">Počet sérií</label>
            <input asp-for="NewExerciseSession.NofSets" class="form-control" type="number" />
        </div>
        <div class="form-group">
            <label for="NewExerciseSession_Note">Poznámka</label>
            <textarea asp-for="NewExerciseSession.Note" class="form-control"></textarea>
        </div>

        <button type="submit" class="btn btn-success mt-2">Uložit</button>
    </form>
}

@section Scripts {
    <script>
        document.getElementById("sessionForm").addEventListener("submit", function (e) {
            const select = document.getElementById("sessionSelect");
            const hiddenInput = document.getElementById("newSessionName");

            if (select.value === "") {
                let name = prompt("Zadejte název nového tréninku:");
                if (!name || name.trim() === "") {
                    alert("Musíte zadat název tréninku!");
                    e.preventDefault();
                    return;
                }
                hiddenInput.value = name.trim();
            }
        });
    </script>
}